# Complete valid OpenAPI 3.1 document with all common features
# Expected: No validation errors
openapi: "3.1.0"
info:
  title: Complete Pet Store API
  version: "2.0.0"
  description: A complete example API with all common OpenAPI features
  summary: Pet management API
  contact:
    name: API Support
    url: https://example.com/support
    email: support@example.com
  license:
    name: Apache 2.0
    identifier: Apache-2.0
  termsOfService: https://example.com/terms

servers:
  - url: https://api.example.com/v2
    description: Production server
    variables:
      basePath:
        default: v2

tags:
  - name: pets
    description: Pet operations
    externalDocs:
      description: Learn more about pet operations
      url: https://example.com/docs/pets

paths:
  /pets:
    get:
      tags:
        - pets
      summary: List all pets
      description: Returns a paginated list of pets
      operationId: listPets
      parameters:
        - name: limit
          in: query
          description: Maximum number of pets to return
          required: false
          schema:
            type: integer
            format: int32
            default: 20
            maximum: 100
        - name: offset
          in: query
          description: Number of pets to skip
          schema:
            type: integer
            default: 0
      responses:
        "200":
          description: A list of pets
          headers:
            X-Total-Count:
              description: Total number of pets
              schema:
                type: integer
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Pet"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalError"
      security:
        - api_key: []

    post:
      tags:
        - pets
      summary: Create a new pet
      description: Creates a new pet in the store
      operationId: createPet
      requestBody:
        description: Pet to add
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NewPet"
      responses:
        "201":
          description: Pet created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Pet"
        "400":
          $ref: "#/components/responses/BadRequest"
      security:
        - api_key: []
        - oauth2:
            - write:pets

  /pets/{petId}:
    parameters:
      - name: petId
        in: path
        required: true
        description: The ID of the pet
        schema:
          type: integer
          format: int64

    get:
      tags:
        - pets
      summary: Get a pet by ID
      operationId: getPetById
      responses:
        "200":
          description: The pet
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Pet"
        "404":
          $ref: "#/components/responses/NotFound"

    delete:
      tags:
        - pets
      summary: Delete a pet
      operationId: deletePet
      responses:
        "204":
          description: Pet deleted
        "404":
          $ref: "#/components/responses/NotFound"
      security:
        - api_key: []

components:
  schemas:
    Pet:
      type: object
      required:
        - id
        - name
      properties:
        id:
          type: integer
          format: int64
          readOnly: true
        name:
          type: string
          minLength: 1
          maxLength: 100
        tag:
          type: string
        status:
          type: string
          enum:
            - available
            - pending
            - sold
        createdAt:
          type: string
          format: date-time
          readOnly: true

    NewPet:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          minLength: 1
        tag:
          type: string
        status:
          type: string
          enum:
            - available
            - pending
            - sold
          default: available

    Error:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: integer
          format: int32
        message:
          type: string

  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"

    InternalError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"

  securitySchemes:
    api_key:
      type: apiKey
      name: X-API-Key
      in: header
      description: API key for authentication

    oauth2:
      type: oauth2
      flows:
        authorizationCode:
          authorizationUrl: https://example.com/oauth/authorize
          tokenUrl: https://example.com/oauth/token
          scopes:
            read:pets: Read pet information
            write:pets: Create and modify pets

security:
  - api_key: []

externalDocs:
  description: Full API documentation
  url: https://example.com/docs

